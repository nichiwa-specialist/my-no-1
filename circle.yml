machine:
  timezone:
    Asia/Tokyo
dependencies:
  pre:
    - curl -o $HOME/go_appengine_1.9.26.zip https://storage.googleapis.com/appengine-sdks/featured/go_appengine_sdk_linux_amd64-1.9.26.zip
    - unzip -q -d $HOME $HOME/go_appengine_1.9.26.zip
    - $HOME/go_appengine/goapp get github.com/ant0ine/go-json-rest/rest
    - $HOME/go_appengine/goapp install github.com/ant0ine/go-json-rest/rest
  override:
    - $HOME/go_appengine/goapp build ./gaehelloworld
test:
  override:
    - $HOME/go_appengine/goapp test ./gaehelloworld
deployment:
  appengine:
    branch: deploy_to_circle
    commands:
      - echo $CLIENT_SECRET | base64 --decode > ${HOME}/client-secret.json
      - gcloud auth activate-service-account --key-file ${HOME}/client-secret.json
      - gcloud -q preview app deploy app.yaml --project my-no-1 --promote --version=2
